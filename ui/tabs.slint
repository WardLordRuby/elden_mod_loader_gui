import { GroupBox, Button, StandardListView } from "std-widgets.slint";
import { Tab, SettingsLogic, MainLogic, Formatting } from "common.slint";

export component ModDetails inherits Tab {
    in property <int> mod-index;
    property <length> details-height: a.height + b.height + c.height + (3*Formatting.default-spacing);
    VerticalLayout {
        y: 0px;
        padding-top: Formatting.default-padding;
        padding-bottom: Formatting.side-padding / 2;
        padding: Formatting.side-padding;
        spacing: Formatting.default-spacing;
        alignment: start;
    
        a := Text {
            font-size: Formatting.font-size-h3;
            text: @tr("Name:");
        }
        b := HorizontalLayout {
            padding-left: Formatting.side-padding;
            Text {
                font-size: Formatting.font-size-h2;
                wrap: word-wrap;
                text: MainLogic.current-mods[mod-index].name;
            }
        }
        c := Text {
            font-size: Formatting.font-size-h3;
            text: @tr("Files:");
        }
    }
    StandardListView {
        y: details-height;
        height: root.height - details-height - Formatting.side-padding;
        width: Formatting.group-box-width - Formatting.side-padding;
        model: MainLogic.current-mods[mod-index].files;
        item-pointer-event(i, event) => {
            if event.kind == PointerEventKind.up {
                MainLogic.edit-config-item(MainLogic.current-mods[mod-index].files[i])
            }
        }
    }
}

export component ModEdit inherits Tab {
    in property <int> mod-index;
    property <length> button-width: MainLogic.current-mods[mod-index].has-config ? 96px : 105px;
    property <LayoutAlignment> button-layout: MainLogic.current-mods[mod-index].has-config ? space-between : end;
    VerticalLayout {
        y: 0px;
        padding-left: Formatting.side-padding;
        alignment: end;
    
        edit-mod-box := GroupBox {
            title: @tr("Edit Mod");
            width: Formatting.group-box-width;
            height: 90px;
            HorizontalLayout {
                width: Formatting.group-box-width;
                padding-right: Formatting.side-padding;
                padding-bottom: Formatting.side-padding / 2;
                alignment: button-layout;
                spacing: Formatting.button-spacing;
                Button {
                    width: button-width;
                    height: 35px;
                    primary: !SettingsLogic.dark-mode;
                    text: @tr("Add Files");
                    clicked => { MainLogic.add-to-mod(MainLogic.current-mods[mod-index].name) }
                }
                if (MainLogic.current-mods[mod-index].has-config) : Button {
                    width: button-width;
                    height: 35px;
                    primary: !SettingsLogic.dark-mode;
                    text: @tr("Edit config");
                    clicked => { MainLogic.edit-config(MainLogic.current-mods[mod-index].config-files) }
                }
                Button {
                    width: button-width;
                    height: 35px;
                    primary: !SettingsLogic.dark-mode;
                    text: @tr("De-register");
                    clicked => { MainLogic.remove-mod(MainLogic.current-mods[mod-index].name) }
                }
            }
        }
    }
}